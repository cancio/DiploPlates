/*
 * grunt-snocketsify
 * https://github.com/suprMax/grunt-snocketsify
 *
 * Copyright (c) 2013 Max Degterev
 * `I dont give a shit` license
 */

'use strict';

module.exports = function(grunt) {

  var snockets = new (require('snockets'))(),
      path = require('path');

  grunt.registerMultiTask('snocketsify',
    'Building js files with snockets.js.',
    function() {
      if (!this.files.length) {
        grunt.log.error('Please provide files to work with.\n');
        return false;
      }

      var parseFileGroup = function(f) {
        if (!f.dest) {
          grunt.log.error('Missing destination file!\n');
          return false;
        }

        f.src.forEach(function(filename) {
          try {
            var js = snockets.getConcatenation(filename, { async: false });

            grunt.file.write(path.resolve(f.dest), js);
            grunt.log.write('File ' + f.dest.cyan + ' created.\n');

            return true;
          } catch (e) {
            grunt.log.error(e);
            return false;
          }
        });
      };
      this.files.forEach(parseFileGroup);

    });
};
